function FlyScript_NO_OP(){}(function(GLOBAL){var UNDEF,NO_OP=FlyScript_NO_OP,READY_STATE="loaded|complete",PKG_MODULE="package.json",ROOT_KEY="/:ROOT:/",TEST_INTERACTIVE=!GLOBAL.addEventListener,ENUM_BUG=(function(){var o={constructor:1};for(var i in o){return false}return true})(),TRIM_RE=/^\s+|(\.js)?\s*$/gi,ROOT_RE=/^\/:ROOT:\//,PROTOCOL_RE=/^[a-z]+:\/\//i,REQUIRE_RE=/\/\/.*|\/\*[\s\S]*?\*\/|"(?:\\[\s\S]|[^"\\])*"|'(?:\\[\s\S]|[^'\\])*'|[;=(,:!^]\s*\/(?:\\.|[^\/\\])+\/|(?:^|\W)\s*require\s*\(\s*("[^"\\]*"|'[^'\\]*')\s*\)/g;var _mountDir={},_mountID={},_homeFile=location.pathname,_homeDir=dir(_homeFile),_scriptRoot=_homeDir,_noCache=false,_scriptTimeout=10000,_head=null;function has(obj,k){return Object.prototype.hasOwnProperty.call(obj,k)}function each(obj,fn){var i,op=Object.prototype;if(!obj){return}for(i in obj){if(!ENUM_BUG||op[i]===UNDEF){if(fn.call(obj,i,obj[i])===false){return}}}if(ENUM_BUG){for(i in op){if(has(obj,i)||obj[i]!==op[i]){if(fn.call(obj,i,obj[i])===false){return}}}}}function matchProp(obj,str){var p=null;if(has(obj,str)){return str}if(str){each(obj,function(k){if(str.indexOf(k)===0&&(p===null||k.length>p.length)){p=k}})}return p}function asap(fn){return setTimeout(fn,10)}function endsWith(s,t){return s.slice(-t.length)===t}function isStr(x){return x&&typeof x==="string"}function isNum(x){return typeof x==="number"}function isObj(x){return x&&typeof x==="object"}function isFn(x){return typeof x==="function"}function isURL(x){return PROTOCOL_RE.test(x)}function addSlash(p){return endsWith(p,"/")?p:(p+"/")}function removeSlash(p){return endsWith(p,"/")?p.slice(0,-1):p}function collapse(path){var a=path.split("/"),out=[],i,e;for(i=0;i<a.length;++i){e=a[i];if(e==="."){continue}else{if(e===".."&&out.length>0){out.pop()}else{out.push(e)}}}return out.join("/")}function dir(path){var i=path.lastIndexOf("/");return(i>=0)?path.substring(0,i+1):""}function suffix(id){if(endsWith(id,"/")){id+=PKG_MODULE}else{if(id.search(/[#\?]/)===-1){id+=".js"}}return id}function scriptURL(src){if(_noCache){src+=(src.indexOf("?")>=0?"&":"?")+(new Date()).getTime()}return src}function toHead(s){var d,h=_head;if(!_head){d=document;h=(_head=d.getElementsByTagName("head")[0])||d.getElementsByTagName("body")[0]||d.documentElement.firstChild}h.insertBefore(s,h.firstChild)}function configure(op){if(!isObj(op)){op={}}var r;if(isStr(op.scriptRoot)){r=addSlash(op.scriptRoot);if(r.charAt(0)!=="/"){r=collapse(_homeDir+r)}_scriptRoot=r}if(isNum(op.scriptTimeout)){_scriptTimeout=Math.floor(op.scriptTimeout)}_noCache=!!op.noCache}function mount(p,m){if(isObj(p)){return each(p,function(pre){mount(pre,p[pre])})}if(!isStr(p)||p.substring(0,1)==="."){return}if(m===UNDEF){m=p;p=""}else{if(!p){p=""}}if(isStr(m)&&m.substring(0,1)==="."){m=collapse(_homeDir+m)}if(endsWith(p,"/")){_mountDir[p]=isStr(m)?addSlash(m):m}else{_mountID[p]=m}}function createLoader(){function Wait(fn){this.fn=fn;this.ready=false}function Module(id,uri){var exp={},path=dir(id),ref=false,deref;this.id=id;this.uri=uri||$baseURI;this.getURI=function(p){return p?collapse(dir(this.uri)+p):this.uri};this._exp=function(by){ref=by||true;return exp};this.setExports=function(e){if(!ref){exp=e}else{throw new Error("Circular initialization error in module '"+id+"'. Referenced by '"+ref+"'.")}};this._deref=deref=function(ident){var m,f;ident=resolve(ident,path,true);m=has($modules,ident)?$modules[ident]:null;if(m&&m instanceof Wait){if(m.ready&&m.fn){f=m.fn;$modules[ident]=m=new Module(ident,m.uri);m.declare(f)}else{m=null}}return m?m._exp(id):null};this._req=function(ident){if($pending){flushQueue()}var m=deref(ident);if(m===null){throw new Error("Module '"+ident+"' is not loaded.")}return m};this.load=function(){var ids=[],a=arguments,fn,i;for(i=0;i<a.length;++i){if(!a[i]){continue}else{if(isStr(a[i])){ids.push(a[i])}else{if(isFn(a[i])){fn=a[i]}else{if(isFn(a[i].concat)){ids=ids.concat(a[i])}}}}}$loadQueue.push([ids,fn||NO_OP,path,null]);flushQueue()};this.declare=function(d,f){if(f===UNDEF){f=d}if(isFn(f)){var e=f(this._req,exp,this);if(e!==UNDEF&&e!==exp){this.setExports(e)}}else{if(isObj(f)){this.setExports(f)}}return exp}}function resolve(id,path,full,lib){if(!isStr(id)){return""}id=id.replace(TRIM_RE,"");var c=id.charAt(0),map,term,pos,pkg;if(c==="."){id=(path||"")+id}else{if(c!=="/"&&!isURL(id)){if(path&&full&&(pkg=matchProp($packages,path))){map=$packages[pkg].mappings;term=((pos=id.indexOf("/"))>0?id.substring(0,pos):id);if(has(map,term)){map=map[term];if(has($alias,map)){map=$alias[map]}id=pos>0?(map+id.substring(pos+1)):(removeSlash(map));return resolve(id,"",true,map+"*")}}id=ROOT_KEY+id}}id=collapse(id);if(full){if(has($alias,id)){id=$alias[id]}else{if(has($alias,lib)){id=$alias[lib]+id.substring(lib.length-1)}}}return id}function fetchScripts(tags){var s,t;expose();while(t=tags.shift()){s=document.createElement("script");if(t.id){$scripts[t.id]=s}s._module=t;s.type="text/javascript";s.src=t.src;s.async=true;s.onload=s.onerror=s.onreadystatechange=scriptLoad(s);scriptTimer(s);toHead(s);setContext(t.id,t.uri)}}function fetchScriptsWorker(tags){var tmr;fetch();function fetch(){if(tmr){clearTimeout(tmr)}var t;while(t=tags.shift()){try{expose();importScripts(t.src);t.done=true}finally{hide();setContext(t.id,t.uri);$fetchCount-=1;if(!t.done){tmr=asap(fetch)}}}flushQueue()}}function scriptLoad(s){return function(evt){if(typeof s.readyState==="undefined"||READY_STATE.indexOf(s.readyState)>=0){scriptDone(s)}}}function scriptTimer(s){function timeout(){if(s.readyState==="interactive"){s._timer=setTimeout(timeout,200)}else{if(!s._timer){s._timer=setTimeout(timeout,_scriptTimeout)}else{s._timer=0;scriptDone(s)}}}timeout()}function scriptDone(s){if(s._done){return}var tag=s._module,id=tag.id,uri=tag.uri,cb;if(s._timer){clearTimeout(s._timer)}s._done=true;s.onerror=s.onload=s.onreadystatechange=NO_OP;if(s.clearAttributes){try{s.clearAttributes()}catch(x){}}if(id){delete $scripts[id]}if(--$fetchCount===0){hide();$scripts={}}setContext(id,uri);flushQueue()}function expose(){if(!$restore){$restore=[GLOBAL.module,GLOBAL.CommonJS];GLOBAL.module=$gModule;GLOBAL.CommonJS=$gCommonJS}}function hide(){if($restore){GLOBAL.module=$restore[0];GLOBAL.CommonJS=$restore[1];$restore=null}}function scriptHook(fn){onContext(fn);if(TEST_INTERACTIVE){each($scripts,function(i,tag){if(tag.readyState==="interactive"){setContext(tag._module.id,tag._module.uri);return false}})}}if(typeof document==="undefined"&&typeof importScripts!=="undefined"){fetchScripts=fetchScriptsWorker}function mapScripts(ids){var map={},list=[],tags=[],pre,i,e,m;for(i=0;i<ids.length;++i){list.push(e={id:ids[i],top:ids[i].replace(ROOT_RE,""),pre:""});if(has(_mountID,e.top)){e.pre=e.top;e.mount=_mountID[e.top]}else{if((pre=matchProp(_mountDir,e.top))!==null){e.pre=pre;e.mount=_mountDir[pre]}}}for(i=0;i<list.length;++i){e=list[i];m=e.mount;if(isStr(m)){tags.push({src:suffix(m+e.top.substring(e.pre.length)),id:e.id})}else{if(isFn(m)){if(!has(map,e.pre)){map[e.pre]=[];map[e.pre].fn=m}map[e.pre].push(e.top)}else{tags.push({src:suffix(e.id.replace(ROOT_RE,_scriptRoot)),id:e.id})}}}each(map,function(p,a){tags=tags.concat(a.fn(a))});for(i=0;i<tags.length;++i){tags[i].uri=tags[i].src;tags[i].src=scriptURL(tags[i].src)}return tags}function flushQueue(){if($loadQueue.length===0){return}var more=true,cbs=[],args,result,q1,q2;$pending=false;while(more){more=false;q1=$loadQueue;q2=[];$loadQueue=[];while(args=q1.pop()){result=load.apply(GLOBAL,args);if(result.fetch){q2.unshift(args);$fetchQueue=$fetchQueue.concat(result.fetch)}else{cbs.push(result);more=true}}if($loadQueue.length>0){more=true}$loadQueue=q2.concat($loadQueue);if($fetchCount===0&&$loadQueue.length){each($modules,function(id,m){if(m instanceof Wait&&!m.ready){more=m.ready=true}})}}runCallbacks(cbs);asap(beginFetch)}function beginFetch(){var list;if($fetchQueue.length){list=$fetchQueue;$fetchQueue=[];fetchScripts(list)}}function runCallbacks(list){var tmr=asap(run);function run(){var a,i,j,cb,fn,ids;if(tmr){clearTimeout(tmr)}try{while(cb=list.shift()){if(!isFn(cb.fn)){continue}fn=cb.fn;ids=cb.ids;for(a=[],j=0;j<ids.length;++j){a.push($baseMod._deref(ids[j]))}cb=null;fn.apply(GLOBAL,a)}}finally{if(cb){list.unshift(cb)}if(list.length>0){tmr=asap(run)}}}}function getFetchList(ids){var list=[],ok=true,pkg,id,i;for(i=0;i<ids.length;++i){id=ids[i];if(!has($modules,id)){ok=false;if((pkg=matchProp($packages,id))&&$packages[pkg]===null){continue}$modules[id]=new Wait();list.push(id)}else{if($modules[id] instanceof Wait&&!$modules[id].ready){ok=false}}}return ok?null:list}function load(ids,fn,path,parent){var rids=[],idList,id,a,i,w;for(i=0;i<ids.length;++i){rids.push(resolve(ids[i],path,true))}ids=rids;idList=getFetchList(ids);if(idList===null){if(parent){for(i=0;i<parent.length;++i){id=parent[i];if((w=$modules[id])&&w instanceof Wait&&w.fn!==UNDEF){w.ready=true}}}return{fn:fn,ids:ids}}else{idList=mapScripts(idList);$fetchCount+=idList.length;return{fetch:idList}}}function onContext(fn){$contextCB.push(fn)}function setContext(id,uri){var restore=$context,cb;$context={id:id,uri:uri};while(cb=$contextCB.shift()){cb(id,uri)}if(!has($modules,id)){attach(id,[],null)}$context=restore}function bundle(data){var p={};p[PKG_MODULE]=data||{};return p}function parseRequire(txt){var dep=[],m;if(txt+=""){for(REQUIRE_RE.lastIndex=0;m=REQUIRE_RE.exec(txt);){if(m[1]){dep.push(m[1].slice(1,-1))}}}return dep}function attach(id,dep,fn,scan){var ids={},path,txt,m;id=resolve(id);path=dir(id);if(fn===UNDEF){fn=dep;dep=null}if(endsWith(id,"/")){attachPackage(removeSlash(path||""),bundle(fn))}else{dep=dep||(scan&&isFn(fn)&&parseRequire(fn))||[];ids[id]=fn;attachSet(ids,dep,path)}}function attachPackage(path,ids){if(!has(ids,PKG_MODULE)){return}var path=isStr(path)?resolve(addSlash(path)):_homeDir,pid=removeSlash(path),data=ids[PKG_MODULE],map={},idx={},dep=[],exp;if(isFn(data)){data=(new Module(path)).declare(data)}each(ids,function(id,fn){idx[path+id]=fn});ids=idx;each(data.mappings,function(id,to){if(!isStr(to)){to=to&&(to.location||to[0])||null}if(!isStr(to)){return}if(!isURL(to)){to="./"+to}var pkg=addSlash(to=resolve(to,path));if(!has($packages,pkg)&&!endsWith(to,"/")){$packages[pkg]=null}dep.push(to);map[id]=pkg});$alias[pid]=resolve(path+(isStr(data.main)?data.main:PKG_MODULE));exp=isObj(data.exports)&&data.exports||{};if(!exp["*"]&&isObj(data.directories)&&isStr(data.directories.lib)){exp["*"]=data.directories.lib}each(exp,function(id,to){if(id==="*"){to=addSlash(to)}$alias[path+id]=resolve(path+to)});$packages[path]={mappings:map};attachSet(ids,dep,null);if($context.id&&$context.id!==pid){$alias[addSlash($context.id)]=path;$alias[$context.id]=$alias[pid]}}function attachSet(ids,dep,path){var list=[],fn,m;if(!isObj(ids)){return}if(!dep||dep.concat===UNDEF){dep=[]}each(ids,function(id,fn){fn=fn||null;id=resolve(id);if(isStr(fn)){fn=new Function("require","exports","module",fn)}if(!has($modules,id)){$modules[id]=new Wait(fn);list.push(id)}else{m=$modules[id];if(m instanceof Wait&&m.fn===UNDEF){m.fn=fn;list.push(id)}}});$loadQueue.push([dep,null,path,list]);$pending=true;each(ids,function(id){$modules[resolve(id)].uri=$context.uri+""})}var $alias={},$modules={},$packages={},$loadQueue=[],$fetchQueue=[],$pending=false,$baseURI=_homeFile,$baseMod=new Module($baseURI),$context={},$contextCB=[],$scripts={},$fetchCount=0,$restore=null;var $gModule={declare:function(dep,fn){scriptHook(function(id){attach(id,dep,fn,true)})}};var $gCommonJS={attachModule:function(id,dep,fn){scriptHook(function(){attach(id,dep,fn)})},attachPackage:function(uri,ids){scriptHook(function(){attachPackage(uri,ids)})},parseDependencies:parseRequire,getCallingContext:onContext};attach("path",null,function(){function base(p,ext){p=p.substring(p.lastIndexOf("/")+1);if(ext&&endsWith(p,ext)){p=p.slice(0,-ext.length)}return p}return{normalize:collapse,normalizeArray:function(a){return collapse(a.join("/")).split("/")},dirname:function(p){return(p=dir(p)).slice(0,-1)},basename:base,extname:function(p){p=base(p);var i=p.lastIndexOf(".");return(i===-1?"":p.substring(i||p.length))},join:function(){var a=arguments,i,out=a[0]||"";for(i=1;i<a.length;++i){out=addSlash(out)+a[i]}return collapse(out)}}});return{attachModule:attach,attachPackage:attachPackage,parseDependencies:parseRequire,load:$baseMod.load,debug:{modules:$modules,aliases:$alias,packages:$packages}}}this.FlyScript=this.CommonJS=createLoader();this.FlyScript.configure=configure;this.FlyScript.mount=mount}).call(this,this);